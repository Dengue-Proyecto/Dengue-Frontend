<nav class="navbar">
  <div class="navbar-container">
    <a routerLink="/inicio">
      <img src="/logo1.png" alt="Logo" class="navbar-logo" />
    </a>

    <!-- Opciones siempre visibles cuando no hay sesiÃ³n (en mÃ³vil tambiÃ©n) -->
    <div *ngIf="!estaLogueado" class="always-visible-links">
      <a routerLink="/iniciar" class="btn-valoration">Iniciar SesiÃ³n</a>
      <a routerLink="/registro" class="btn-valoration">Registrarse</a>
      <!-- BotÃ³n de tema -->
      <button class="theme-toggle" (click)="toggleTheme()" [title]="isDarkMode ? 'Modo claro' : 'Modo oscuro'">
        {{ isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}
      </button>
    </div>

    <!-- BotÃ³n hamburguesa para mÃ³viles (solo cuando hay sesiÃ³n) -->
    <button *ngIf="estaLogueado" class="mobile-menu-toggle" (click)="toggleMobileMenu()" [class.active]="mobileMenuOpen">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- MenÃº mÃ³vil (solo para usuarios logueados) -->
    <div *ngIf="estaLogueado" class="navbar-links-mobile" [class.mobile-open]="mobileMenuOpen">
      <!-- Indicador de usuario (solo visible en mÃ³vil cuando el menÃº estÃ¡ abierto) -->
      <div class="user-info-mobile">
        <div class="user-avatar">
          <span>{{ inicialesUsuario }}</span>
        </div>
        <div class="user-details">
          <span class="user-name">{{ nombreUsuario || 'Usuario' }}</span>
          <span class="user-label">MÃ©dico registrado</span>
        </div>
      </div>

      <div class="nav-items">
        <a routerLink="/formulario" class="btn-valoration" (click)="closeMobileMenu()">Evaluar</a>
        <a routerLink="/evaluaciones" class="btn-valoration" (click)="closeMobileMenu()">Ver evaluaciones</a>
        <a (click)="toggleTheme(); closeMobileMenu()" class="btn-valoration">
          {{ isDarkMode ? 'â˜€ï¸ Modo claro' : 'ğŸŒ™ Modo oscuro' }}
        </a>
        <a (click)="logout(); closeMobileMenu()" class="btn-valoration">Cerrar sesiÃ³n</a>
      </div>
    </div>

    <!-- Contenedor derecho: Usuario + BotÃ³n tema (solo usuarios logueados en desktop) -->
    <div *ngIf="estaLogueado" class="navbar-right">
      <!-- Indicador de usuario desktop con menÃº desplegable -->
      <div class="user-dropdown-container">
        <div class="user-info-desktop" (click)="toggleUserMenu()">
          <div class="user-avatar">
            <span>{{ inicialesUsuario }}</span>
          </div>
          <span class="user-name-desktop">{{ nombreUsuario || 'Usuario' }}</span>
          <span class="dropdown-arrow" [class.open]="userMenuOpen">â–¼</span>
        </div>

        <!-- MenÃº desplegable -->
        <div class="user-dropdown-menu" [class.open]="userMenuOpen">
          <a routerLink="/formulario" class="dropdown-item" (click)="closeUserMenu()">
            Evaluar
          </a>
          <a routerLink="/evaluaciones" class="dropdown-item" (click)="closeUserMenu()">
            Ver evaluaciones
          </a>
          <a (click)="logout(); closeUserMenu()" class="dropdown-item">
            Cerrar sesiÃ³n
          </a>
        </div>
      </div>

      <!-- BotÃ³n de tema para usuarios logueados (desktop) - siempre a la derecha del usuario -->
      <button class="theme-toggle" (click)="toggleTheme()" [title]="isDarkMode ? 'Modo claro' : 'Modo oscuro'">
        {{ isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}
      </button>
    </div>

    <!-- Overlay para cerrar menÃº de usuario -->
    <div *ngIf="userMenuOpen" class="user-menu-overlay" (click)="closeUserMenu()"></div>

    <!-- Overlay para cerrar menÃº en mÃ³vil (solo cuando hay sesiÃ³n) -->
    <div *ngIf="estaLogueado" class="mobile-overlay" [class.active]="mobileMenuOpen" (click)="closeMobileMenu()"></div>
  </div>
</nav>
