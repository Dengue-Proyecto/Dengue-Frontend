<nav class="navbar">
  <div class="navbar-container">
    <a routerLink="/inicio">
      <img src="/logo1.png" alt="Logo" class="navbar-logo" />
    </a>

    <!-- Opciones siempre visibles cuando no hay sesión (en móvil también) -->
    <div *ngIf="!estaLogueado" class="always-visible-links">
      <a routerLink="/iniciar" class="btn-valoration">Iniciar Sesión</a>
      <a routerLink="/registro" class="btn-valoration">Registrarse</a>
    </div>

    <!-- Botón hamburguesa para móviles (solo cuando hay sesión) -->
    <button *ngIf="estaLogueado" class="mobile-menu-toggle" (click)="toggleMobileMenu()" [class.active]="mobileMenuOpen">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Menú móvil (solo para usuarios logueados) -->
    <div *ngIf="estaLogueado" class="navbar-links-mobile" [class.mobile-open]="mobileMenuOpen">
      <!-- Indicador de usuario (solo visible en móvil cuando el menú está abierto) -->
      <div class="user-info-mobile">
        <div class="user-avatar">
          <span>{{ inicialesUsuario }}</span>
        </div>
        <div class="user-details">
          <span class="user-name">{{ nombreUsuario || 'Usuario' }}</span>
          <span class="user-label">Médico registrado</span>
        </div>
      </div>

      <div class="nav-items">
        <a routerLink="/formulario" class="btn-valoration" (click)="closeMobileMenu()">Evaluar</a>
        <a routerLink="/evaluaciones" class="btn-valoration" (click)="closeMobileMenu()">Ver evaluaciones</a>
        <a (click)="logout(); closeMobileMenu()" class="btn-valoration">Cerrar sesión</a>
      </div>
    </div>

    <!-- Indicador de usuario desktop con menú desplegable -->
    <div *ngIf="estaLogueado" class="user-dropdown-container">
      <div class="user-info-desktop" (click)="toggleUserMenu()">
        <div class="user-avatar">
          <span>{{ inicialesUsuario }}</span>
        </div>
        <span class="user-name-desktop">{{ nombreUsuario || 'Usuario' }}</span>
        <span class="dropdown-arrow" [class.open]="userMenuOpen">▼</span>
      </div>

      <!-- Menú desplegable -->
      <div class="user-dropdown-menu" [class.open]="userMenuOpen">
        <a routerLink="/formulario" class="dropdown-item" (click)="closeUserMenu()">
          Evaluar
        </a>
        <a routerLink="/evaluaciones" class="dropdown-item" (click)="closeUserMenu()">
          Ver evaluaciones
        </a>
        <a (click)="logout(); closeUserMenu()" class="dropdown-item">
          Cerrar sesión
        </a>
      </div>
    </div>

    <!-- Overlay para cerrar menú de usuario -->
    <div *ngIf="userMenuOpen" class="user-menu-overlay" (click)="closeUserMenu()"></div>

    <!-- Overlay para cerrar menú en móvil (solo cuando hay sesión) -->
    <div *ngIf="estaLogueado" class="mobile-overlay" [class.active]="mobileMenuOpen" (click)="closeMobileMenu()"></div>
  </div>
</nav>
